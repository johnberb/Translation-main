<% if (user) { %>
<div class="container-fluid px-4 py-3 bg-dark text-light min-vh-100">

  <!-- Header Section -->
  <header class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center mb-3 mb-md-0">
      <h2 class="m-0">
        <a href="/dashboard" class="text-light text-decoration-none hover-primary">THE MESSAGE TRANSFER HUB</a>
      </h2>
    </div>
    <div class="d-flex align-items-center">
      <span class="me-3">Welcome, <span class="fw-bold text-success"><%= user.name %></span></span>
      <a href="/users/logout" class="btn btn-outline-success rounded-pill px-3">Logout</a>
    </div>
  </header>

  <!-- Search Bar -->
  <nav class="navbar navbar-dark bg-dark border border-success rounded-3 p-2 mb-4">
    <div class="container-fluid px-0">
      <form class="d-flex w-100" action="/search" method="get">
        <input class="form-control me-2 rounded-pill" type="search" placeholder="Search files..." aria-label="Search" name="search">
        <button class="btn btn-outline-success rounded-pill px-4" type="submit">
          <i class="bi bi-search me-1"></i> Search
        </button>
      </form>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="row g-4">
    <!-- File Upload Section -->
    <div class="col-lg-6">
      <div class="card bg-dark border-success h-100">
        <div class="card-body">
          <h4 class="card-title text-success mb-4">
            <i class="bi bi-cloud-arrow-up me-2"></i>Upload Your File
          </h4>

          <% if(locals.fileLink != null){ %>
          <div class="alert alert-success d-flex align-items-center mb-4">
            <i class="bi bi-check-circle-fill me-2"></i>
            <div>
              Your file is uploaded: 
              <a href="<%= locals.fileLink %>" class="alert-link text-break"><%= locals.fileLink %></a>
            </div>
          </div>
          <% } %>

          <form action="/upload" method="post" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="file" class="form-label text-light">Select File</label>
              <input type="file" id="file" name="file" required 
                class="form-control rounded-pill bg-secondary text-dark border-success"
                accept=".pdf,.zip,.txt,.doc,.docx,.xml,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
            </div>
            
            <div class="mb-4">
              <label for="password" class="form-label text-light">Password Protection (optional)</label>
              <div class="input-group">
                <input type="password" id="password" name="password" 
                  class="form-control rounded-pill bg-secondary text-dark border-success">
                <button class="btn btn-outline-secondary rounded-pill" type="button" id="togglePassword">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
            </div>

            <button class="btn btn-success rounded-pill px-4 py-2 w-100" type="submit">
              <i class="bi bi-send me-2"></i>Share File
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- File List Section -->
    <div class="col-lg-6">
      <div class="card bg-dark border-success h-100">
        <div class="card-body">
          <h4 class="card-title text-success mb-4">
            <i class="bi bi-folder me-2"></i>Your Files
          </h4>
          
          <% if(files.length > 0) { %>
          <div class="list-group">
            <% files.forEach(function(file) { %>
            <a href="/file/<%= file._id %>" 
              class="list-group-item list-group-item-action bg-secondary text-dark border-success mb-2 rounded-3 d-flex justify-content-between align-items-center">
              <span class="text-truncate">
                <i class="bi bi-file-earmark me-2"></i><%= file.originalName %>
              </span>
              <i class="bi bi-download text-success"></i>
            </a>
            <% }); %>
          </div>
          <% } else { %>
          <div class="text-center py-4">
            <i class="bi bi-folder-x text-muted" style="font-size: 3rem;"></i>
            <p class="mt-3 text-muted">No files uploaded yet</p>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

<!-- Password Toggle Script -->
<script>
  document.getElementById('togglePassword').addEventListener('click', function() {
    const passwordInput = document.getElementById('password');
    const icon = this.querySelector('i');
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      icon.classList.replace('bi-eye', 'bi-eye-slash');
    } else {
      passwordInput.type = 'password';
      icon.classList.replace('bi-eye-slash', 'bi-eye');
    }
  });
</script>

<% } else { %>
<script>
  window.location.href = '/login';
</script>
<% } %>